!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("d3")):"function"==typeof define&&define.amd?define(["d3"],e):t.Onboard=e(t.d3)}(this,function(t){"use strict";function e(t,e){return void 0===t?e:t}var n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];n(this,t),this._handlers=e.reduce(function(t,e){return t[e]=[],t},{})}return r(t,[{key:"on",value:function(t,e){var n=this;if(!(t in this._handlers))throw"No such event: "+t;return this._handlers[t].push(e),{destroy:function(){n.off(t,e)}}}},{key:"off",value:function(t,e){if(!(t in this._handlers))throw"No such event: "+t;if(e){var n=this._handlers[t],r=n.indexOf(e);-1!=r&&n.splice(r,1)}else this._handlers[t]=[];return this}},{key:"fire",value:function(t){if(!(t in this._handlers))throw"No such event: "+t;for(var e=this._handlers[t],n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0;o<e.length;o++)e[o].apply(this,r);return this}},{key:"destroy",value:function(){return this._handlers=null,this}}]),t}(),o=function(t,e){if("undefined"==typeof document)return e;t=t||"";var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");return r.type="text/css",r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t)),n.appendChild(r),e}("._svg_7ryie_1 {\r\n    position:absolute;\r\n    top:0;\r\n    left:0;\r\n}\r\n\r\n._bg_7ryie_13 {\r\n\r\n}\r\n\r\n._mask_7ryie_21 {\r\n\r\n}\r\n\r\n._window_7ryie_29 {\r\n    display: none;\r\n    position:absolute;\r\n    width:400px;\r\n    min-height:200px;\r\n    left:calc(50% - 200px);\r\n    top:calc(50% - 100px);\r\n    border-radius: 5px;\r\n    background-color: #ffffff;\r\n    box-shadow: 0 15px 20px 0 rgba(0, 0, 0, .2);\r\n    font-family: Roboto;\r\n    padding-bottom: 30px;\r\n}\r\n\r\n._window-next-btn_7ryie_57 {\r\n    display: block;\r\n    position: absolute;\r\n    right:30px;\r\n    text-align: left;\r\n    bottom:30px;\r\n    padding:8px 15px 8px 15px;\r\n    text-transform: uppercase;\r\n    cursor: pointer;\r\n    box-sizing: border-box;\r\n    border-radius: 5px;\r\n    font-size: 10px;\r\n    font-weight: bold;\r\n    letter-spacing: 1px;\r\n    -webkit-user-select: none;\r\n       -moz-user-select: none;\r\n        -ms-user-select: none;\r\n            user-select: none;\r\n    color: #49ace2;\r\n    border: solid 2px #49ace2\r\n}\r\n\r\n._window-next-btn_7ryie_57>._window-btn-icon_7ryie_95 {\r\n    font-size:19px;\r\n    position:absolute;\r\n    display: none;\r\n    right:15px;\r\n    top:5px;\r\n}\r\n\r\n._window-button-has-next_7ryie_111 {\r\n    padding:8px 50px 8px 15px;\r\n}\r\n._window-button-has-next_7ryie_111>._window-btn-icon_7ryie_95 {\r\n    display: block;\r\n}\r\n\r\n._window-prev-btn_7ryie_125 {\r\n    display: block;\r\n    position: absolute;\r\n    left:30px;\r\n    bottom:30px;\r\n    padding:5px;\r\n    color: #cacaca;\r\n    pointer-events: none;\r\n    cursor: default;\r\n}\r\n\r\n._window-prev-btn_7ryie_125>._window-btn-icon_7ryie_95 {\r\n    font-size:19px;\r\n}\r\n\r\n._window-title_7ryie_155 {\r\n    position:relative;\r\n    margin-top:25px;\r\n    margin-left:30px;\r\n    font-size: 16px;\r\n    font-weight: bold;\r\n}\r\n\r\n._window-body_7ryie_171 {\r\n    position:relative;\r\n    margin-top:19px;\r\n    margin-left:30px;\r\n    margin-right: 30px;\r\n    font-size: 12px;\r\n    line-height: 1.5;\r\n}\r\n\r\n._window-button-has-prev_7ryie_189 {\r\n    color: #49ace2;\r\n    pointer-events: all;\r\n    cursor: pointer;\r\n}\r\n\r\n._arrow_7ryie_201 {\r\n    position: absolute;\r\n    width:72px;\r\n    top:0px;\r\n    left:0px;\r\n    height: 63px;\r\n    background-image:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAAA/CAMAAAB0FH4MAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAYUExURc/S0vj4+LG1tuLj5L/Cw+7v7////////xCL/GQAAAAIdFJOU/////////8A3oO9WQAAASZJREFUeNrs19FuwzAIBdBrDOT//3ix5zaeltY0XE3VVD9EUaWcgAFHxZZbquMGSce9sqAhJaENu2QM6C6loZ5dSUEK9JJpadKrEKy0949IvEvSpCgkcjzt+Am1OwtBWsvt5X6r0pRa/ykEHWE82GzbwpAtnOcQbPS/Pi3+qiGxb4xHgl2MiE77+niV9dDuBTINVHR9jIzWiXbqRlo4zRsMqM1gJUDyfSrkIQ3UPJYaQNvsN4LkfslB9do2/4YCwx6CijsYEDyT2QSJF3m78v9LCJUDyaWz7ASqqV6coNRwTJDmMxsRWaqpP539AiQkCJe+rCeQuQsFIrR1hyR3Vh+Q5gd2pKb4dPZfQSocCJR2bN8hyoC0f1KsiAoLMsqk9apxyv8lwABLqnllZeE1EQAAAABJRU5ErkJggg==');\r\n}\r\n\r\n._arrow-right-top_7ryie_219 {\r\n    -webkit-transform: rotate(0deg);\r\n            transform: rotate(0deg);\r\n    margin-left: -10px;\r\n    margin-top: -7px;\r\n}\r\n\r\n._arrow-right-bottom_7ryie_231 {\r\n    -webkit-transform: scaleY(-1);\r\n            transform: scaleY(-1);\r\n    margin-left: -10px;\r\n    margin-top: 10px;\r\n}\r\n\r\n._arrow-left-top_7ryie_243 {\r\n    -webkit-transform: rotate(-90deg);\r\n            transform: rotate(-90deg);\r\n    margin-left: -7px;\r\n    margin-top: 15px;\r\n}\r\n\r\n._arrow-left-bottom_7ryie_255 {\r\n    margin-top: -10px;\r\n    -webkit-transform: scaleY(-1) rotate(-90deg);\r\n            transform: scaleY(-1) rotate(-90deg);\r\n}\r\n\r\n._window-right-top_7ryie_265 {\r\n    \r\n}\r\n",{svg:"_svg_7ryie_1",bg:"_bg_7ryie_13","-webkit-mask":"_mask_7ryie_21",mask:"_mask_7ryie_21",window:"_window_7ryie_29","window-next-btn":"_window-next-btn_7ryie_57","window-btn-icon":"_window-btn-icon_7ryie_95","window-button-has-next":"_window-button-has-next_7ryie_111","window-prev-btn":"_window-prev-btn_7ryie_125","window-title":"_window-title_7ryie_155","window-body":"_window-body_7ryie_171","window-button-has-prev":"_window-button-has-prev_7ryie_189",arrow:"_arrow_7ryie_201","arrow-right-top":"_arrow-right-top_7ryie_219","arrow-right-bottom":"_arrow-right-bottom_7ryie_231","arrow-left-top":"_arrow-left-top_7ryie_243","arrow-left-bottom":"_arrow-left-bottom_7ryie_255","window-right-top":"_window-right-top_7ryie_265"}),s=function(){function e(t,r){n(this,e),this._options=t,this._containerEl=null,this._svgEl=null,this._stepElements=[],this._rendered=!1,this._model=r,this._onStartBinding=this._model.on("start",this._onStart.bind(this)),this._onStepBinding=this._model.on("step",this._onStep.bind(this)),this._onStopBinding=this._model.on("stop",this._onStop.bind(this))}return r(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"render",value:function(e){return this._containerEl=t.select(e||document.body),this._renderMask(),this._rendered=!0,this}},{key:"_getViewSize",value:function(){return{width:Math.max(document.documentElement.offsetWidth,document.documentElement.clientWidth),height:Math.max(document.documentElement.offsetHeight,document.documentElement.clientHeight)}}},{key:"_renderMask",value:function(){var t=this,e=this._getViewSize();this._svgEl=this._containerEl.append("svg").attr("class",o.svg).attr("width",e.width).attr("height",e.height),this._defsEl=this._svgEl.append("defs"),this._maskEl=this._defsEl.append("mask").attr("class",o.mask).attr("id","onboarding-mask").attr("width","100%").attr("height","100%").attr("x",0).attr("y",0),this._maskBg=this._maskEl.append("rect").attr("class",o.bg).attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","white"),this._bgEl=this._svgEl.append("rect").attr("class",o.bg).attr("width","100%").attr("height","100%").attr("x",0).attr("y",0).attr("mask","url(#onboarding-mask)").attr("fill",this._options.fillColor).attr("fill-opacity",this._options.fillOpacity),this._onWindowResize=function(){var e=t._getViewSize();t._svgEl.attr("width",e.width),t._svgEl.attr("height",e.height)},window.addEventListener("resize",this._onWindowResize)}},{key:"_onStart",value:function(){return this._svgEl.style("display","block"),this}},{key:"_clearSteps",value:function(){this._stepElements.forEach(function(t){return t.remove()})}},{key:"_renderStep",value:function(t){var e=this;t.selection.nodes().forEach(function(n){e._stepElements.push(e._renderStepElement(n,t))})}},{key:"_renderStepElement",value:function(t,e){var n=e.shape||{type:"rectangle"};return"path"==t.tagName?this._renderPathMask(t,e):"circle"==n.type?this._renderCircleMask(t,e):this._renderRectangleMask(t,e)}},{key:"_getBorderRadius",value:function(t){return parseFloat(window.getComputedStyle(t,null).getPropertyValue("border-top-left-radius"))}},{key:"_renderRectangleMask",value:function(t,e){var n=t.getBoundingClientRect(),r=this._getBorderRadius(t);return this._maskEl.append("rect").attr("fill","black").attr("x",n.left).attr("y",n.top).attr("rx",r).attr("ry",r).attr("width",n.width).attr("fill-opacity",1).attr("stroke-opacity",1).attr("stroke-width",e.shape?e.shape.offset||0:0).attr("stroke","black").attr("height",n.height)}},{key:"_renderCircleMask",value:function(t,e){var n=t.getBoundingClientRect(),r=n.left+n.width/2,i=n.top+n.height/2;return this._maskEl.append("circle").attr("r",e.shape.radius||n.width/2).attr("fill","black").attr("fill-opacity",1).attr("stroke-width",e.shape?e.shape.offset||0:0).attr("stroke-opacity",1).attr("stroke","black").attr("cx",r).attr("cy",i)}},{key:"_renderPathMask",value:function(e,n){for(var r=e.parentElement;r&&"svg"!=r.tagName;)r=r.parentElement;var i=r.getBoundingClientRect();return this._maskEl.append("g").attr("transform","translate("+i.left+", "+i.top+")").append("path").attr("fill","black").attr("fill-opacity",1).attr("stroke-width",n.shape?n.shape.offset||0:0).attr("stroke","black").attr("d",t.select(e).attr("d"))}},{key:"_onStep",value:function(t){return this._clearSteps(),this._renderStep(t),this}},{key:"_onStop",value:function(){return this._svgEl.style("display","none"),this}},{key:"destroy",value:function(){return this._rendered&&window.removeEventListener("resize",this._onWindowResize),this._clearSteps(),this._onStartBinding.destroy(),this._onStepBinding.destroy(),this._onStopBinding.destroy(),this}}]),e}(),a=function(){function t(){n(this,t)}return r(t,[{key:"getWindowPosition",value:function(t,e,n){var r=this._getTargetPosition(t,n);return{position:r,left:this._getLeftWindowPosition(r,t,n,e),top:this._getTopWindowPosition(r,t,n,e)}}},{key:"_getLeftWindowPosition",value:function(t,e,n,r){return{"left-top":e.left+e.width/2+n.width,"right-top":e.left-n.width-r.width,"left-bottom":e.left+e.width/2+n.width,"right-bottom":e.left-r.width-n.width}[t]}},{key:"_getTopWindowPosition",value:function(t,e,n,r){return{"left-top":e.top+e.height+n.height,"right-top":e.top+e.height/2+n.height,"left-bottom":e.top-r.height-n.height,"right-bottom":e.top-r.height+n.height}[t]}},{key:"getArrowPosition",value:function(t,e){var n=this._getTargetPosition(t,e);return{position:n,left:this._getLeftArrowPosition(n,t,e),top:this._getTopArrowPosition(n,t,e)}}},{key:"_getLeftArrowPosition",value:function(t,e,n){return{"left-top":e.left+e.width/2,"right-top":e.left-n.width,"left-bottom":e.left+e.width/2,"right-bottom":e.left-n.width}[t]}},{key:"_getTopArrowPosition",value:function(t,e,n){return{"left-top":e.top+e.height,"right-top":e.top+e.height/2,"left-bottom":e.top-n.height,"right-bottom":e.top+n.height}[t]}},{key:"_getTargetPosition",value:function(t){var e=[t.left,t.top],n=[.5*document.documentElement.clientWidth,.5*document.documentElement.clientHeight],r=["left","top"];return["right","bottom"].forEach(function(t,i){e[i]>n[i]&&(r[i]=t)}),r.join("-")}}]),t}(),h=function(){function e(t,r){n(this,e),this._options=t,this._containerEl=null,this._rendered=!1,this._model=r,this._onStartBinding=this._model.on("start",this._onStart.bind(this)),this._onStepBinding=this._model.on("step",this._onStep.bind(this)),this._onStopBinding=this._model.on("stop",this._onStop.bind(this)),this._positionResolver=new a}return r(e,[{key:"getArrowBox",value:function(){return this._arrowBox}},{key:"isRendered",value:function(){return this._rendered}},{key:"render",value:function(e){return this._containerEl=t.select(e||document.body),this._renderArrow(),this._rendered=!0,this}},{key:"_renderArrow",value:function(){this._arrowEl=this._containerEl.append("div").attr("class",o.arrow+" "+o["arrow-bottom-right"]),this._arrowBox=this._arrowEl.node().getBoundingClientRect()}},{key:"_onStart",value:function(){return this._arrowEl.style("display","block"),this}},{key:"_onStep",value:function(t){var e=t.selection.nodes()[0],n=e.getBoundingClientRect(),r=this._positionResolver.getArrowPosition(n,this._arrowBox);return this._arrowEl.style("left",r.left+"px"),this._arrowEl.style("top",r.top+"px"),this._arrowEl.attr("class",o.arrow+" "+o["arrow-"+r.position]),this}},{key:"_onStop",value:function(){return this._arrowEl.style("display","none"),this}},{key:"destroy",value:function(){return this._onStartBinding.destroy(),this._onStepBinding.destroy(),this._onStopBinding.destroy(),this._arrowEl&&this._arrowEl.remove(),this}}]),e}(),l=function(){function e(t,r){n(this,e),this._options=t,this._containerEl=null,this._rendered=!1,this._model=r,this._onStartBinding=this._model.on("start",this._onStart.bind(this)),this._onStepBinding=this._model.on("step",this._onStep.bind(this)),this._onStopBinding=this._model.on("stop",this._onStop.bind(this)),this._positionResolver=new a,this._arrowRenderer=new h(t,r)}return r(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"render",value:function(e){return this._containerEl=t.select(e||document.body),this._renderWindow(),this._arrowRenderer.render(e),this._rendered=!0,this}},{key:"_renderWindow",value:function(){this._windowEl=this._containerEl.append("div").attr("class",o.window),this._nextBtnEl=this._windowEl.append("div").on("click",this._onNextClick.bind(this)).attr("class",o["window-next-btn"]),this._nextBtnTextEl=this._nextBtnEl.append("span").attr("class",o["window-next-btn-text"]).html(this._options.nextText),this._nextBtnIconEl=this._nextBtnEl.append("div").attr("class",o["window-btn-icon"]+" zmdi zmdi-long-arrow-right"),this._prevBtnEl=this._windowEl.append("div").attr("class",o["window-prev-btn"]).on("click",this._onPrevClick.bind(this)).html(this._options.prevText),this._prevBtnEl.append("div").attr("class",o["window-btn-icon"]+" zmdi zmdi-long-arrow-left"),this._titleEl=this._windowEl.append("div").attr("class",o["window-title"]),this._bodyEl=this._windowEl.append("div").attr("class",o["window-body"])}},{key:"_onNextClick",value:function(){this._model.hasNext()?this._model.next():this._model.stop()}},{key:"_onPrevClick",value:function(){this._model.prev()}},{key:"_onStart",value:function(){return this._windowEl.style("display","block"),this}},{key:"_onStep",value:function(t){this._titleEl.html(t.title),this._bodyEl.html(t.text),this._prevBtnEl.classed(o["window-button-has-prev"],this._model.hasPrev()),this._nextBtnEl.classed(o["window-button-has-next"],this._model.hasNext()),this._model.hasNext()?this._nextBtnTextEl.html(this._options.nextText):this._nextBtnTextEl.html(this._options.understandText);var e=t.selection.nodes()[0],n=e.getBoundingClientRect(),r=this._windowEl.node().getBoundingClientRect(),i=this._positionResolver.getWindowPosition(n,r,this._arrowRenderer.getArrowBox());return this._windowEl.style("left",i.left+"px"),this._windowEl.style("top",i.top+"px"),this._windowEl.attr("class",o.window+" "+o["window-"+i.position]),this}},{key:"_onStop",value:function(){return this._windowEl.style("display","none"),this}},{key:"destroy",value:function(){return this._onStartBinding.destroy(),this._onStepBinding.destroy(),this._onStopBinding.destroy(),this}}]),e}(),d=function(){function e(t,r){n(this,e),this._options=t,this._containerEl=null,this._rendered=!1,this._model=r,this._observable=new i([]),this._maskRenderer=new s(t,r),this._windowRenderer=new l(t,r)}return r(e,[{key:"isRendered",value:function(){return this._rendered}},{key:"render",value:function(e){return this._containerEl=t.select(e||document.body),this._maskRenderer.render(e),this._windowRenderer.render(e),this._rendered=!0,this}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"destroy",value:function(){return this._observable.destroy(),this}}]),e}(),_=function(){function t(e){n(this,t),this._steps=e.steps||[],this._currentStep=null,this._currentStepIndex=-1,this._observable=new i(["start","stop","step"])}return r(t,[{key:"getSteps",value:function(){return this._steps}},{key:"start",value:function(){this._currentStepIndex=0,this._currentStep=this._steps[this._currentStepIndex],this._observable.fire("start",this._currentStep,this._currentStepIndex),this._observable.fire("step",this._currentStep,this._currentStepIndex)}},{key:"stop",value:function(){this._observable.fire("stop"),this._currentStep=null,this._currentStepIndex=-1}},{key:"next",value:function(){this.hasNext()&&(this._currentStep=this._steps[++this._currentStepIndex],this._observable.fire("step",this._currentStep,this._currentStepIndex))}},{key:"prev",value:function(){this.hasPrev()&&(this._currentStep=this._steps[--this._currentStepIndex],this._observable.fire("step",this._currentStep,this._currentStepIndex))}},{key:"hasNext",value:function(){return this._steps.length>this._currentStepIndex+1}},{key:"hasPrev",value:function(){return this._currentStepIndex>0}},{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._currentStep=null,this}}]),t}();return function(){function t(r){n(this,t),this._options={},this._options.fillColor=e(r.fillColor,"#000000"),this._options.fillOpacity=e(r.fillOpacity,.25),this._options.nextText=e(r.nextText,"Next"),this._options.understandText=e(r.understandText,"Got it"),this._options.animationDuration=e(r.animationDuration,250),this._options.steps=r.steps,this._observable=new i([]),this._model=new _(this._options),this._onboardRenderer=new d(this._options,this._model),this.render()}return r(t,[{key:"on",value:function(t,e){return this._observable.on(t,e),this}},{key:"off",value:function(t,e){return this._observable.off(t,e),this}},{key:"destroy",value:function(){return this._observable.destroy(),this._onboardRenderer.destroy(),this._options=null,this._model.destroy(),this}},{key:"render",value:function(t){return this._onboardRenderer.render(t),this}},{key:"start",value:function(){return this._model.start(),this}},{key:"stop",value:function(){return this._model.stop(),this}}]),t}()});
//# sourceMappingURL=onboard.min.js.map
